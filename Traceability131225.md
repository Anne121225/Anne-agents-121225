技術規格重點版本（保留原架構精神，但強化「來源流向申報資料」的設計與 AI Agent 應用）。

0. 修訂後總結摘要（以來源流向申報 + AI Agent 為核心）

本修訂版聚焦說明：如何運用
<span style="color:coral">多代理人 AI（AI Agent）</span>
針對 <span style="color:coral">醫療器材來源流向申報資料</span> 進行
<span style="color:coral">清洗與標準化</span>、
<span style="color:coral">關聯與追蹤</span>、
<span style="color:coral">異常偵測</span>、
<span style="color:coral">合規審查</span>、
與 <span style="color:coral">決策支援</span>。

核心思路：

把所有「來源流向申報」資料（進口、製造、出貨、轉運、銷售、醫院收貨、退回等）視為可機器理解的 <span style="color:coral">標準化事件流</span>（events）。
以 <span style="color:coral">AI Agent</span> 為「智慧審查員」與「風險分析師」，自動幫 TFDA 與業者
檢查申報資料完整性與合理性（欄位有無缺漏、數量是否異常）；
連結歷史資料與其他來源（許可證、不良事件、IoT 冷鏈、財報新聞）；
找出可疑流向（如「異常多跳點流向」、「數量對不上」、「進口≠銷售+在庫+耗損」）；
主動生成風險告警與召回建議。
將每次 AI 分析與判斷結果、使用到的來源流向申報紀錄摘要，寫入 <span style="color:coral">區塊鏈聯盟鏈</span> 或審計資料庫，做為 <span style="color:coral">監管可驗證證據</span> 與 <span style="color:coral">持續訓練資料</span>（RLHF）來源。
經由這樣的設計，TFDA 可在不大幅增加人工審查負擔的情況下，將大量來源流向申報資料轉化為：

假冒偽劣醫材之 <span style="color:coral">早期偵測訊號</span>；
產品召回與追溯的 <span style="color:coral">快速路徑</span>；
供應鏈韌性與政策制定的 <span style="color:coral">決策資料資產</span>。
1. 修訂重點說明

本次修改重點：

在 資料層 增加「來源流向申報資料模型」與欄位規格。
在 多代理人 AI 區塊 中，新增／強化 3 類專責 Agent：
<span style="color:coral">來源流向資料品質 Agent</span>
<span style="color:coral">來源流向關聯與追蹤 Agent</span>（擴充原 Traceability Agent）
<span style="color:coral">來源流向異常偵測與合規 Agent</span>
新增多個 應用情境：以來源流向申報資料為主軸之風險預警、假冒偵測、量差分析等。
更新實體表格與 JSON，強調「來源流向申報紀錄」在整體知識圖譜中的角色。
2. 醫療器材來源流向申報資料：概念與資料模型

2.1 「來源流向申報」在系統中的角色
「來源流向申報」可理解為：業者（進口商、製造商、經銷商、醫療機構）向 TFDA 或其他主管機關申報的：

來源：從何處取得醫療器材（進口、委託製造、上游經銷商）。
流向：將產品流向何處（下游客戶、醫療機構、其他經銷商）。
狀態：庫存結存、報廢、退貨、贈品、樣品等。
這些申報資料若結構化、標準化，AI Agent 可做的事包括：

算「進出平衡」：來源（進、製造） vs 流向（出、報廢、在庫）。
找「異常路徑」：如過度繞路、多層轉手。
比「歷史模式」：與歷史期間相比，本期是否出現異常成長或下降。
連「不良事件」：某批產品不良事件是否與特定來源／流向型態高度關聯。
2.2 來源流向申報資料欄位建議（資料模型）
表 1：來源流向申報資料核心欄位（範例）

欄位名稱	類型	說明
report_id	String	申報紀錄唯一識別碼
report_date	Date	申報日期
reporter_id	String	申報單位 ID（統一編號或 TFDA 代碼）
reporter_role	Enum	角色（進口商、製造商、經銷商、醫療機構）
product_udi	String	產品 UDI-DI
lot_number	String	批號
serial_number_range	String/JSON	序號範圍（如適用）
source_type	Enum	來源類型（進口、國內製造、上游經銷、院內退回等）
source_entity_id	String	來源單位 ID
destination_type	Enum	流向類型（下游客戶、醫療機構、海外輸出、報廢等）
destination_entity_id	String	流向單位 ID
qty_in	Number	本筆來源數量
qty_out	Number	本筆流向數量
balance_after_tx	Number	交易後結存數量（可由系統計算）
tx_type	Enum	交易型態（進貨、銷貨、調撥、借出歸還、報廢等）
related_shipment_id	String	關聯運輸批次 ID（如有）
related_blockchain_txid	String	關聯區塊鏈交易 ID（如已上鏈）
remark	String	備註，如特殊專案、緊急採購
2.3 資料來源與整合
來源流向申報資料可能來自：

TFDA 既有「來源流向申報系統」或報表（紙本／Excel／XML）。
進出口報單（海關系統）。
製造／WMS／ERP 系統匯出（CSV、API）。
醫院 HIS／物料管理系統之收發記錄。
AI Agent 的其中一個工作，就是自動：

解析 非結構化或半結構化 報表；
將異質欄位映射到統一資料模型；
檢查欄位缺漏或格式錯誤，並回饋給申報單位。
3. 如何利用 AI Agent 處理「來源流向申報資料」

3.1 AI Agent 分工總覽
在原多代理人架構上，與「來源流向申報」最相關的可整理如下。

表 2：與來源流向申報密切相關的 AI Agent

Agent 名稱	主要任務
來源流向資料品質 Agent	解析申報檔案、欄位驗證、缺漏與不一致偵測、回報修正建議
來源流向關聯與追蹤 Agent	將申報紀錄連結到產品批次、運輸批次、醫療機構與患者紀錄
來源流向異常偵測與合規 Agent	偵測數量異常、路徑異常、角色異常；比對法規與常規模式
風險預測 Agent（擴充）	將來源流向資料納入整體風險評分與斷鏈／假冒風險分析
以下分別說明。

3.2 來源流向資料品質 Agent
3.2.1 任務

將各種格式的申報檔（Excel、CSV、PDF 掃描表格）轉為標準化結構。
檢查必填欄位是否齊全（如 UDI、批號、數量、來源／流向 ID）。
檢查欄位值是否合法（日期格式、ID 是否存在於主數據、數量是否為正整數）。
檢查簡單的平衡關係（同一申報單前後欄位的數量加總是否對得上）。
3.2.2 技術方法

表格理解模型（如 LayoutLM、Table Transformer）處理掃描 PDF 報表。
規則引擎（Drools 等）定義欄位規則與跨欄位關聯規則。
主數據比對（與產品、廠商、醫療機構主檔對照）。
表 3：資料品質檢查規則示例

規則代號	規則說明	處理動作
R-DQ-01	若 product_udi 不存在於主檔，標記為「未知產品」	退回申報或請求補充說明
R-DQ-02	若 qty_in 或 qty_out 為負數或非數字	標記錯誤欄位並拒絕寫入主資料庫
R-DQ-03	若 source_entity_id 非本系統已知單位	發出提示，要求業者補登或更新主檔
R-DQ-04	若同一批次在同一日申報多筆相同來源流向且數量矛盾	標註為「疑似重複或錯誤申報」，人工確認
Agent 會產生一份「資料品質檢查報告」，顯示通過／警示／錯誤項目，並可回饋到 Portal。

3.3 來源流向關聯與追蹤 Agent（Traceability 擴充）
3.3.1 任務

將每一筆來源流向申報視為「一個事件（Event）」加到供應鏈知識圖譜。
連結關係包括：
批次（Lot） ←→ 報表申報事件
來源單位 ←→ 批次 ←→ 流向單位
申報事件 ←→ 運輸批次 ←→ IoT 感測器紀錄
支援由「任何一個點」回推或前推完整路徑（where from, where to）。
3.3.2 實務應用

使用者輸入：某批號 + 某段期間，查詢該批產品所有來源與流向。
系統透過圖譜（Neo4j 等）執行查詢並繪出路徑，並可標示使用來源流向申報資料推定的節點。
表 4：來源流向圖譜中的主要關係

關係類型	節點 A	節點 B	說明
SUPPLIED_BY	產品批次（Lot）	原物料供應商	某批次使用某供應商原料
REPORTED_SOURCE	來源流向申報事件	來源單位	此申報事件指出來源單位
REPORTED_DEST	來源流向申報事件	流向單位	此申報事件指出流向單位
SHIPPED_AS	來源流向申報事件	運輸批次	銷貨事件與實際運輸批次的對應
USED_AT	產品（序號化單品）	醫療機構／病患	在何處被使用或植入
3.4 來源流向異常偵測與合規 Agent
3.4.1 任務類型

數量一致性檢查
比較一段期間內：
進貨／進口總數 + 國內製造總數
vs 銷貨總數 + 報廢總數 + 期末庫存估算
若差距超出合理誤差範圍，標記為「數量異常」。
路徑異常偵測
通常路徑：製造商 → 經銷商（1~2 層）→ 醫院。
若出現：多層轉手、跨區轉手反覆、短期內反覆進出同一批次，則標記為「可疑流向」。
角色與產品／數量不符
例如某診所申報短時間內大量進出高價植入物，超過其臨床量能。
合規規則比對
假如有法規要求：某類高風險醫材不可透過非授權通路販售，Agent 會檢查申報紀錄有無違反。
表 5：異常偵測規則示例

規則代號	規則說明	觸發條件示例
R-AN-01	數量平衡異常	期間內進貨 + 製造 −（銷貨 + 報廢 + 庫存變化）> 5%
R-AN-02	路徑過度繞路	單批次在 30 天內被轉手超過 N 次（如 > 5 次）
R-AN-03	診所用量異常	單診所在一季內進用某高風險植入物數量 > 歷史均值 3 倍
R-AN-04	未授權通路販售	來源或流向單位不在該產品授權通路名單內
當規則觸發時，Agent 會：

計算異常指標（如 Z-score、風險分數）；
產生「疑似異常事件」，送給風險 Agent 與 TFDA 審查員；
視嚴重程度觸發進一步行動（函請說明、臨場稽查、加強抽驗）。
3.5 資料驅動決策支援：風險 Agent 的擴充應用
來源流向申報資料成為風險 Agent 的關鍵特徵來源之一，例如：

某供應商的產品，在多個經銷通路出現「數量平衡異常」或「路徑繞路」情況，風險分數上升。
某類高風險醫材在特定時間內，流向某幾家醫院的數量激增，且同時出現較多不良事件通報，風險 Agent 標記該組合為高風險。
表 6：風險 Agent 使用的來源流向特徵範例

特徵類型	特徵說明
數量變化特徵	月／季進貨與出貨量的環比、同比變化率
路徑複雜度特徵	單批次平均轉手次數、最長路徑長度
角色異常特徵	異常角色（如小診所）對高風險產品的用量比例
平衡異常次數	過去一年中數量平衡異常的次數與嚴重度
風險分數高的實體（供應商、產品、醫療機構）將被標記於監管 Dashboard，作為優先稽查或抽驗對象。

4. 來源流向申報資料的 AI 流程：從申報到決策

4.1 整體流程（文字版）
資料輸入：
業者透過 Portal 上傳申報檔案（Excel、CSV、XML、PDF），或系統 API 自動推送。
資料品質 Agent 處理：
檔案解析 → 欄位對映 → 格式與必填欄位檢查 → 資料品質報告。
不合格資料退回業者或暫存於「待人工核對」區。
資料入庫與上鏈：
通過檢查者寫入來源流向資料表與知識圖譜；
關鍵事件（如高風險產品批次的首次進口或重大轉移）寫入區塊鏈。
追蹤 Agent 關聯：
將新的申報事件連到相關批次、供應商、醫療機構與運輸批次；
更新圖譜，立即可查詢最新流向。
異常偵測與合規 Agent 分析：
以批次、產品、單位、期間為單位，進行數量平衡與路徑分析；
觸發異常事件與風險通知。
風險 Agent 統合評估：
將上述異常、其它資料（不良事件、IoT、新聞）一併考量，更新風險分數。
人機共決與回饋：
審查員於 Portal 檢視 AI 提供的異常解釋與建議，做出最終判斷並給予回饋；
回饋結果再用於後續 AI 模型的 RLHF 訓練。
5. 典型應用情境（以來源流向申報為主）

5.1 假冒醫材早期偵測情境
某高價植入物正常情況下只授權給少數大型醫院。
某季來源流向申報顯示：多家小診所出現該產品大筆進用紀錄。
異常偵測 Agent：
覺得「診所用量異常」+「未在授權通路名單中」，觸發高風險事件。
風險 Agent 將該產品與相關診所列為高風險；
TFDA 審查員：
透過系統立即查詢「這些診所的來源是誰？」
可追溯上游經銷商與中間轉手路徑，鎖定可能假貨源頭。
5.2 產品召回加速情境
某植入物批次 LOT202412A 被國外發現品質問題。
TFDA 指示召回。
系統透過來源流向申報資料，在幾秒內算出：
哪些單位曾報進該批號；
多少已流向醫院、多少仍在經銷或庫存。
醫療機構 Portal 可立即看到「本院需召回數量」與曾使用於哪些病患。
5.3 不良事件與流向型態關聯分析情境
過去一年針對某心臟支架的不良事件增加。
系統從來源流向申報資料中提取：
這些不良事件涉及的批次，是否有共同的「來源供應商／經銷路線」？
若發現特定經銷鏈路上的批次不良率明顯偏高，可能存在：
中途儲存不當（冷鏈中斷）；
非法替換；
特定市場的操作環境問題。
6. 新增／調整的中文表格（示例）

以下為針對來源流向申報與 AI Agent 的代表性表格（均為繁體中文）。

表 7：來源流向申報資料處理流程－Agent 責任分工
流程步驟	責任 Agent	輸入	輸出／結果
檔案上傳	（無，使用者操作）	Excel／CSV／PDF 報表	原始檔案
檔案解析與欄位對映	來源流向資料品質 Agent	原始檔案	結構化紀錄（JSON／表格）
欄位與主檔檢查	來源流向資料品質 Agent	結構化紀錄	資料品質報告、合格或退回標記
寫入主資料庫	系統服務（Data Service）	合格紀錄	來源流向資料表更新
圖譜關聯建模	來源流向關聯與追蹤 Agent	來源流向資料、主數據	供應鏈知識圖譜更新
異常偵測與合規檢查	來源流向異常偵測與合規 Agent	新增／累積來源流向資料	異常事件、合規預警
風險評估整合	風險 Agent	異常事件、其它風險指標	更新風險分數、優先稽查名單
表 8：來源流向異常類型與可能風險說明
異常類型	說明	潛在風險
數量平衡異常	進貨 + 製造 − 出貨 − 報廢 − 庫存 ≠ 0	未申報流向、漏報、假貨混入或帳務錯誤
路徑過度繞路	單批次在短期內轉手次數遠高於常態	掩飾來源、洗貨、灰色通路
角色用量異常	某角色（如診所）之用量明顯超出歷史或同儕水準	非法轉售、違反適應症規範
未授權通路	流向單位未在授權銷售／使用名單內	灰色通路或假冒產品的經銷點
7. 更新後的 20 個關鍵實體與語境（表格與 JSON）

7.1 表格（已納入「來源流向申報事件」）
與前版相比，特別強調 E21（新增實體）：「來源流向申報事件」。
表 9：關鍵實體與語境說明（更新版）

實體 ID	實體名稱	類別	說明／語境
E01	原物料供應商	組織	提供醫療器材原料或組件，與來源流向申報中的來源單位相關
E02	醫療器材製造商	組織	持證人／製造廠，為許多來源流向事件的發起者
E03	經銷商／通路商	組織	產品在國內之主要流向節點，在申報資料中扮演來源與流向雙重角色
E04	物流服務商	組織	為來源流向事件提供實際運輸服務，與運輸批次、IoT 資料關聯
E05	醫療機構	組織	來源流向申報中最終流向範圍之一，亦可進行退回與轉出
E06	病患	人	最終使用者，與產品批次／序號建立匿名化關聯
E07	醫療器材產品	物件	具有 UDI 的產品，為來源流向申報紀錄的主要標的
E08	產品批次（Lot）	物件／事件	是來源流向申報、品質檢驗與召回的最小管理單位
E09	序號化單品	物件	單件產品，與個別患者及使用紀錄關聯
E10	IoT 感測器裝置	裝置	與運輸批次與來源流向事件綁定，提供冷鏈證據
E11	運輸批次	事件／物件	將產品從來源單位實際運至流向單位的物流實體
E12	檢驗報告	文件	品質檢測文件，與特定批次及來源流向事件關聯
E13	許可證	法規文件	定義產品合法性與可銷售通路，為合規檢查的依據
E14	不良事件通報	事件	可與特定來源流向型態關聯，用以查找風險鏈路
E15	召回事件	事件	需要來源流向申報資料支持，追蹤召回覆蓋率與完成度
E16	區塊鏈交易紀錄	技術／紀錄	寫入關鍵來源流向事件摘要，形成不可竄改追溯證據
E17	智慧合約（鏈碼）	技術／邏輯	定義來源流向紀錄寫入及異常標註的規則
E18	AI 代理人	軟體代理	負責解析、關聯、偵測與評估來源流向申報資料
E19	供應鏈知識圖譜	資料結構	將來源流向申報事件轉化為實體與關係網路
E20	風險評分	指標／度量	將來源流向異常情形納入供應鏈風險量化
（如需，E21 可定義為「來源流向申報事件」，此處保持前 20 個實體需求的一致性）

7.2 JSON（更新版
